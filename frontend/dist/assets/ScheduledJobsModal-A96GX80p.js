import{z as B,r as _,o as O,x as R,e as l,i as n,l as t,L as u,u as i,A as a,F as $,j as C,p as b,I as J,K as h,H as T}from"./vue-core-Chol9MOc.js";import{c as D,C as p,X as z,a as A,T as M}from"./index-C1X3nxtu.js";import"./tiptap-zBojtxx-.js";import"./markdown-B3lvOPUD.js";import"./highlight-BX1zPj8W.js";/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=D("ToggleLeftIcon",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=D("ToggleRightIcon",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),j={class:"glass-solid rounded-3xl w-full max-w-lg max-h-[80vh] flex flex-col animate-modal-enter relative overflow-hidden"},H={class:"flex items-center justify-between p-6 border-b border-white/5"},q={class:"flex items-center gap-3"},K={class:"p-2 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20"},U={class:"text-lg font-semibold text-[var(--text-primary)]"},X={class:"flex-1 overflow-y-auto p-6 custom-scroll"},Y={key:0,class:"text-center py-12"},G={class:"w-16 h-16 rounded-2xl bg-gradient-to-br from-cyan-500/10 to-blue-500/10 flex items-center justify-center mx-auto mb-4"},Q={class:"text-[var(--text-secondary)]"},W={class:"text-sm text-[var(--text-muted)] mt-1"},Z={key:1,class:"space-y-3"},ee=["onClick"],te={class:"flex items-start justify-between gap-3"},se={class:"flex-1 min-w-0"},oe={class:"flex items-center gap-2"},ae={class:"font-medium text-[var(--text-primary)] truncate"},ne={class:"text-sm text-[var(--text-secondary)] mt-0.5 ml-6"},le=["title"],re={class:"flex items-center gap-3 mt-2 ml-6 text-xs text-[var(--text-muted)]"},ie={key:0},ce={key:1},de={class:"flex items-center gap-2 flex-shrink-0"},ue=["onClick","title"],he=["onClick","title"],ve={key:0,class:"border-t border-[var(--border-subtle)] p-4 bg-[var(--bg-elevated)]"},me={key:0},xe={class:"text-sm font-medium text-[var(--text-primary)] mb-2"},_e={class:"space-y-2"},fe=["onClick"],ge={class:"text-sm text-[var(--text-secondary)] truncate flex-1"},be={class:"text-xs text-[var(--text-muted)] flex-shrink-0"},pe={key:1,class:"text-sm text-[var(--text-muted)]"},ye={class:"flex items-center gap-2 mt-4"},we=["onClick"],ke=["onClick","disabled"],Se={__name:"ScheduledJobsModal",emits:["close","show-details","select-conversation","refresh-conversations","new-conversation"],setup($e,{emit:I}){const v=I,{t:y}=B(),m=_([]),c=_(null),d=_(null),f=_(!1);let x=null;const g=async()=>{try{const e=await fetch("/scheduled-jobs");e.ok&&(m.value=await e.json())}catch(e){console.error("Failed to fetch scheduled jobs",e)}},S=async e=>{try{const o=await fetch(`/scheduled-jobs/${e}/details`);o.ok&&(d.value=await o.json())}catch(o){console.error("Failed to fetch job details",o)}},F=async e=>{c.value===e?(c.value=null,d.value=null):(c.value=e,await S(e))},L=async(e,o)=>{try{await fetch(`/scheduled-jobs/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_enabled:o})}),await g()}catch(s){console.error("Failed to toggle scheduled job",s)}},E=async e=>{if(confirm(y("confirmations.deleteJob")))try{await fetch(`/scheduled-jobs/${e}`,{method:"DELETE"}),c.value===e&&(c.value=null,d.value=null),await g()}catch(o){console.error("Failed to delete scheduled job",o)}},N=async e=>{f.value=!0;try{const o=await fetch(`/scheduled-jobs/${e}/trigger`,{method:"POST"});if(o.ok){const s=await o.json();if(s.conversation_id){const r=m.value.find(k=>k.id===e);v("new-conversation",{id:s.conversation_id,preview:r?.name||y("modals.scheduledJobs.scheduledTask"),created_at:new Date().toISOString(),last_message_at:new Date().toISOString(),has_active_job:!0,has_pending_question:!1,is_unread:!1,unread_count:0,is_scheduler_run:!0}),v("select-conversation",s.conversation_id),v("close");return}}}catch(o){console.error("Failed to trigger scheduled job",o)}finally{f.value=!1}},w=e=>e?new Date(e).toLocaleString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";return O(()=>{g(),x=setInterval(()=>{v("refresh-conversations")},3e3)}),R(()=>{x&&(clearInterval(x),x=null)}),(e,o)=>(n(),l("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:o[1]||(o[1]=h(s=>e.$emit("close"),["self"]))},[t("div",j,[o[2]||(o[2]=t("div",{class:"absolute top-0 left-8 right-8 h-px bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent"},null,-1)),t("div",H,[t("div",q,[t("div",K,[u(i(p),{class:"w-5 h-5 text-cyan-400"})]),t("h2",U,a(e.$t("modals.scheduledJobs.title")),1)]),t("button",{onClick:o[0]||(o[0]=s=>e.$emit("close")),class:"p-2 rounded-xl text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-surface)] transition-all"},[u(i(z),{class:"w-5 h-5"})])]),t("div",X,[m.value.length===0?(n(),l("div",Y,[t("div",G,[u(i(p),{class:"w-8 h-8 text-cyan-400/50"})]),t("p",Q,a(e.$t("modals.scheduledJobs.noJobs")),1),t("p",W,a(e.$t("modals.scheduledJobs.askAssistant")),1)])):(n(),l("div",Z,[(n(!0),l($,null,C(m.value,s=>(n(),l("div",{key:s.id,class:"bg-white/5 border border-white/5 rounded-xl overflow-hidden hover:bg-white/[0.07] transition-colors"},[t("div",{class:"p-4 cursor-pointer",onClick:r=>F(s.id)},[t("div",te,[t("div",se,[t("div",oe,[u(i(A),{class:J(["w-4 h-4 text-[var(--text-muted)] transition-transform",{"rotate-180":c.value===s.id}])},null,8,["class"]),t("h3",ae,a(s.name),1)]),t("p",ne,a(s.schedule_description),1),t("p",{class:"text-xs text-[var(--text-muted)] mt-1 ml-6 truncate",title:s.prompt},a(s.prompt),9,le),t("div",re,[s.next_run_at?(n(),l("span",ie,a(e.$t("modals.scheduledJobs.next"))+": "+a(w(s.next_run_at)),1)):b("",!0),s.run_count>0?(n(),l("span",ce,a(e.$t("modals.scheduledJobs.runs"))+": "+a(s.run_count),1)):b("",!0)])]),t("div",de,[t("button",{onClick:h(r=>L(s.id,!s.is_enabled),["stop"]),class:J([s.is_enabled?"text-emerald-400 hover:text-emerald-300":"text-[var(--text-muted)] hover:text-[var(--text-secondary)]","transition-colors"]),title:s.is_enabled?e.$t("common.disable"):e.$t("common.enable")},[s.is_enabled?(n(),T(i(V),{key:0,class:"w-6 h-6"})):(n(),T(i(P),{key:1,class:"w-6 h-6"}))],10,ue),t("button",{onClick:h(r=>E(s.id),["stop"]),class:"p-1.5 text-[var(--text-muted)] hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-all",title:e.$t("common.delete")},[u(i(M),{class:"w-4 h-4"})],8,he)])])],8,ee),c.value===s.id?(n(),l("div",ve,[d.value&&d.value.conversations&&d.value.conversations.length>0?(n(),l("div",me,[t("h4",xe,a(e.$t("modals.scheduledJobs.recentRuns")),1),t("div",_e,[(n(!0),l($,null,C(d.value.conversations.slice(0,5),r=>(n(),l("div",{key:r.id,class:"flex items-center gap-2 p-2 rounded-lg bg-[var(--bg-surface)] border border-[var(--border-subtle)] hover:bg-[var(--bg-overlay)] cursor-pointer transition-colors",onClick:k=>e.$emit("select-conversation",r.id)},[u(i(p),{class:"w-4 h-4 text-cyan-500 flex-shrink-0"}),t("span",ge,a(r.preview||e.$t("modals.scheduledJobs.noPreview")),1),t("span",be,a(w(r.created_at)),1)],8,fe))),128))])])):(n(),l("div",pe,a(e.$t("modals.scheduledJobs.noRunsYet")),1)),t("div",ye,[t("button",{onClick:h(r=>e.$emit("show-details",s.id),["stop"]),class:"px-3 py-1.5 text-sm bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg transition-colors"},a(e.$t("modals.scheduledJobs.viewDetails")),9,we),t("button",{onClick:h(r=>N(s.id),["stop"]),class:"px-3 py-1.5 text-sm bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg transition-colors",disabled:f.value},a(e.$t("modals.scheduledJobs.runNow")),9,ke)])])):b("",!0)]))),128))]))])])]))}};export{Se as default};
