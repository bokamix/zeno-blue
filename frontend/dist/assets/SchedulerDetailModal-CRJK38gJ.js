import{z as ae,r as c,f as oe,o as le,e as l,i as r,l as t,p as n,L as U,u as W,A as a,B as h,C as re,Z as $,F as b,j as p,I as de,_ as ne,M as ie,K as ue}from"./vue-core-Chol9MOc.js";import{c as ce,C as z,X as ve}from"./index-zeDdM9R3.js";import"./tiptap-zBojtxx-.js";import"./markdown-B3lvOPUD.js";import"./highlight-BX1zPj8W.js";/**
 * @license lucide-vue-next v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=ce("ChevronRightIcon",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),ye={class:"glass-solid rounded-3xl w-full max-w-2xl max-h-[85vh] flex flex-col animate-modal-enter relative overflow-hidden"},be={class:"flex items-center justify-between p-6 border-b border-[var(--border-subtle)]"},pe={class:"flex items-center gap-3"},he={class:"p-2 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20"},xe={class:"text-lg font-semibold text-[var(--text-primary)]"},fe={key:0,class:"text-sm text-[var(--text-secondary)]"},ge={key:0,class:"flex-1 flex items-center justify-center"},_e={key:1,class:"flex-1 overflow-y-auto p-6 custom-scroll space-y-6"},$e={class:"text-sm font-medium text-[var(--text-primary)] mb-2"},ke={key:0,class:"text-sm text-[var(--text-secondary)] bg-[var(--bg-elevated)] border border-[var(--border-subtle)] rounded-lg p-3 whitespace-pre-wrap"},we={key:2,class:"mt-2 space-y-3"},De=["placeholder"],Ce={class:"flex gap-2"},Se=["disabled"],Me={class:"text-sm font-medium text-[var(--text-primary)] mb-2"},Ie={class:"flex items-center gap-4 text-sm"},je={class:"bg-[var(--bg-elevated)] border border-[var(--border-subtle)] rounded-lg p-3 flex-1"},Oe={class:"text-[var(--text-muted)] text-xs mb-1"},Ve={class:"text-[var(--text-primary)]"},Fe={class:"bg-[var(--bg-elevated)] border border-[var(--border-subtle)] rounded-lg p-3 flex-1"},Te={class:"text-[var(--text-muted)] text-xs mb-1"},Pe={class:"text-[var(--text-primary)]"},Ne={key:0,class:"mt-3 p-3 bg-[var(--bg-elevated)] border border-[var(--border-subtle)] rounded-lg space-y-3"},Re={class:"text-xs text-[var(--text-secondary)] font-medium block mb-1"},Ue={value:"everyMinutes"},We={value:"daily"},Ee={value:"weekly"},Le={value:"monthly"},qe={value:"customDays"},ze={key:0},Ae={class:"text-xs text-[var(--text-secondary)] font-medium block mb-1"},Be=["value"],He={key:1},Je={class:"text-xs text-[var(--text-secondary)] font-medium block mb-1"},Ke={value:"1"},Xe={value:"2"},Ye={value:"3"},Ze={value:"4"},Ge={value:"5"},Qe={value:"6"},et={value:"0"},tt={key:2},st={class:"text-xs text-[var(--text-secondary)] font-medium block mb-1"},at=["value"],ot={key:3},lt={class:"text-xs text-[var(--text-secondary)] font-medium block mb-1"},rt={class:"flex flex-wrap gap-2"},dt=["value"],nt={class:"text-sm"},it={key:4},ut={class:"text-xs text-[var(--text-secondary)] font-medium block mb-1"},ct={class:"flex items-center gap-2"},vt=["value"],mt=["value"],yt={class:"flex gap-2 pt-2"},bt=["disabled"],pt={key:0},ht={class:"text-sm font-medium text-[var(--text-primary)] mb-2"},xt={class:"bg-[var(--bg-elevated)] border border-[var(--border-subtle)] rounded-lg p-3 space-y-2"},ft={key:0},gt={class:"text-[var(--text-muted)] text-xs mb-1"},_t={class:"list-disc list-inside text-sm text-[var(--text-secondary)]"},$t={key:1},kt={class:"text-[var(--text-muted)] text-xs mb-1"},wt={class:"text-sm text-[var(--text-secondary)]"},Dt={class:"text-cyan-400"},Ct={key:1},St={class:"text-sm font-medium text-[var(--text-primary)] mb-2"},Mt={class:"bg-[var(--bg-elevated)] border border-[var(--border-subtle)] rounded-lg p-3"},It={class:"text-[var(--text-muted)] text-xs mb-2"},jt={class:"flex flex-wrap gap-2"},Ot={class:"text-sm font-medium text-[var(--text-primary)] mb-2"},Vt={key:0,class:"space-y-2"},Ft=["onClick"],Tt={class:"flex-1 min-w-0"},Pt={class:"text-sm text-[var(--text-primary)] truncate"},Nt={class:"text-xs text-[var(--text-secondary)] font-medium"},Rt={key:1,class:"text-sm text-[var(--text-muted)] bg-[var(--bg-elevated)] border border-[var(--border-subtle)] rounded-lg p-3"},Ut={class:"flex items-center gap-4 text-sm text-[var(--text-muted)]"},Wt={key:0},Et={key:2,class:"flex items-center justify-between p-6 border-t border-[var(--border-subtle)]"},Lt={class:"flex items-center gap-3"},qt=["disabled"],Kt={__name:"SchedulerDetailModal",props:{schedulerId:{type:String,required:!0}},emits:["close","select-conversation","deleted"],setup(A,{emit:B}){const x=A,C=B,{t:y,locale:H}=ae(),d=c(null),E=c(!0),S=c(!1),M=c(!1),f=c(!1),g=c(!1),_=c(""),I=c(!1),i=c("daily"),j=c("1"),O=c(1),V=c("09"),F=c("00"),k=c([]),T=c(5),J=[{key:"monday",value:"1"},{key:"tuesday",value:"2"},{key:"wednesday",value:"3"},{key:"thursday",value:"4"},{key:"friday",value:"5"},{key:"saturday",value:"6"},{key:"sunday",value:"0"}],K=e=>{if(!e)return;const o=e.split(" ");if(o.length<5)return;const[s,u,v,,m]=o;if(s.startsWith("*/")&&u==="*"&&v==="*"&&m==="*"){i.value="everyMinutes",T.value=parseInt(s.substring(2),10)||5;return}F.value=s.padStart(2,"0"),V.value=u.padStart(2,"0"),m!=="*"&&v==="*"?m.includes(",")?(i.value="customDays",k.value=m.split(",")):(i.value="weekly",j.value=m):v!=="*"?(i.value="monthly",O.value=parseInt(v,10)):i.value="daily"},X=()=>{if(i.value==="everyMinutes")return`*/${T.value} * * * *`;const e=parseInt(F.value,10),o=parseInt(V.value,10);if(i.value==="daily")return`${e} ${o} * * *`;if(i.value==="weekly")return`${e} ${o} * * ${j.value}`;if(i.value==="customDays"){const s=k.value.sort((u,v)=>parseInt(u)-parseInt(v)).join(",");return`${e} ${o} * * ${s||"*"}`}else return`${e} ${o} ${O.value} * *`},Y=e=>{if(!e)return"";const o=e.split(" ");if(o.length<5)return e;const[s,u,v,,m]=o;if(s.startsWith("*/")&&u==="*"&&v==="*"&&m==="*"){const w=parseInt(s.substring(2),10);return y("modals.schedulerDetail.everyXMinutes",{minutes:w})}const R=`${u.padStart(2,"0")}:${s.padStart(2,"0")}`,L={0:"sunday",1:"monday",2:"tuesday",3:"wednesday",4:"thursday",5:"friday",6:"saturday"};if(m==="*"&&v==="*")return y("modals.schedulerDetail.everyDay",{time:R});if(v!=="*")return y("modals.schedulerDetail.everyMonthDay",{day:v,time:R});if(m!=="*"){const w=m.split(",");if(w.length===1){const D=L[w[0]];return y("modals.schedulerDetail.everyWeekday",{day:y(`days.${D}`),time:R})}else{const D=w.map(se=>y(`days.${L[se]}`)),q=D.pop(),te=D.length>0?`${D.join(", ")} ${y("common.and")} ${q}`:q;return y("modals.schedulerDetail.everyWeekdays",{days:te,time:R})}}return e},P=async()=>{E.value=!0;try{const e=await fetch(`/scheduled-jobs/${x.schedulerId}/details`);e.ok&&(d.value=await e.json(),K(d.value.cron_expression))}catch(e){console.error("Failed to fetch scheduler details",e)}finally{E.value=!1}},Z=async()=>{S.value=!0;try{const e=X();(await fetch(`/scheduled-jobs/${x.schedulerId}/schedule`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({cron_expression:e})})).ok&&(await P(),f.value=!1)}catch(e){console.error("Failed to update schedule",e)}finally{S.value=!1}},G=async()=>{if(_.value.trim()){I.value=!0;try{(await fetch(`/scheduled-jobs/${x.schedulerId}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:_.value.trim()})})).ok&&(await P(),g.value=!1)}catch(e){console.error("Failed to update prompt",e)}finally{I.value=!1}}},Q=async()=>{M.value=!0;try{const e=await fetch(`/scheduled-jobs/${x.schedulerId}/trigger`,{method:"POST"});if(e.ok){const o=await e.json();if(o.conversation_id){C("select-conversation",o.conversation_id),C("close");return}}}catch(e){console.error("Failed to trigger scheduler",e)}finally{M.value=!1}},ee=async()=>{if(confirm(y("confirmations.deleteJob")))try{await fetch(`/scheduled-jobs/${x.schedulerId}`,{method:"DELETE"}),C("deleted"),C("close")}catch(e){console.error("Failed to delete scheduler",e)}},N=e=>e?new Date(e).toLocaleString(H.value,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"";return oe(()=>x.schedulerId,()=>{P()}),le(()=>{P()}),(e,o)=>(r(),l("div",{class:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:o[14]||(o[14]=ue(s=>e.$emit("close"),["self"]))},[t("div",ye,[o[17]||(o[17]=t("div",{class:"absolute top-0 left-8 right-8 h-px bg-gradient-to-r from-transparent via-cyan-500/50 to-transparent"},null,-1)),t("div",be,[t("div",pe,[t("div",he,[U(W(z),{class:"w-5 h-5 text-cyan-400"})]),t("div",null,[t("h2",xe,a(d.value?.name||e.$t("modals.schedulerDetail.title")),1),d.value?(r(),l("p",fe,a(d.value.schedule_description),1)):n("",!0)])]),t("button",{onClick:o[0]||(o[0]=s=>e.$emit("close")),class:"p-2 rounded-xl text-[var(--text-muted)] hover:text-[var(--text-primary)] hover:bg-[var(--bg-surface)] transition-all"},[U(W(ve),{class:"w-5 h-5"})])]),E.value?(r(),l("div",ge,[...o[15]||(o[15]=[t("div",{class:"animate-spin w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full"},null,-1)])])):d.value?(r(),l("div",_e,[t("div",null,[t("h3",$e,a(e.$t("modals.schedulerDetail.whatItDoes")),1),g.value?n("",!0):(r(),l("p",ke,a(d.value.prompt),1)),g.value?n("",!0):(r(),l("button",{key:1,onClick:o[1]||(o[1]=s=>{g.value=!0,_.value=d.value.prompt}),class:"mt-2 text-sm text-cyan-600 hover:text-cyan-700 font-medium transition-colors"},a(e.$t("modals.schedulerDetail.editPrompt")),1)),g.value?(r(),l("div",we,[h(t("textarea",{"onUpdate:modelValue":o[2]||(o[2]=s=>_.value=s),rows:"6",class:"w-full bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-lg px-3 py-2 text-sm text-[var(--text-primary)] focus:outline-none focus:border-cyan-500/50 resize-y",placeholder:e.$t("modals.schedulerDetail.promptPlaceholder")},null,8,De),[[re,_.value]]),t("div",Ce,[t("button",{onClick:o[3]||(o[3]=s=>g.value=!1),class:"px-4 py-2 text-sm text-[var(--text-primary)] hover:bg-[var(--bg-overlay)] rounded-lg transition-colors"},a(e.$t("common.cancel")),1),t("button",{onClick:G,disabled:I.value||!_.value.trim(),class:"px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg text-sm transition-colors disabled:opacity-50"},a(I.value?e.$t("common.saving"):e.$t("common.save")),9,Se)])])):n("",!0)]),t("div",null,[t("h3",Me,a(e.$t("modals.schedulerDetail.schedule")),1),t("div",Ie,[t("div",je,[t("div",Oe,a(e.$t("modals.schedulerDetail.runsAt")),1),t("span",Ve,a(Y(d.value.cron_expression)),1)]),t("div",Fe,[t("div",Te,a(e.$t("modals.schedulerDetail.nextRun")),1),t("span",Pe,a(N(d.value.next_run_at)||"-"),1)])]),t("button",{onClick:o[4]||(o[4]=s=>f.value=!f.value),class:"mt-2 text-sm text-cyan-600 hover:text-cyan-700 font-medium transition-colors"},a(f.value?e.$t("common.cancel"):e.$t("modals.schedulerDetail.editSchedule")),1),f.value?(r(),l("div",Ne,[t("div",null,[t("label",Re,a(e.$t("modals.schedulerDetail.frequency")),1),h(t("select",{"onUpdate:modelValue":o[5]||(o[5]=s=>i.value=s),class:"w-full bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-lg px-3 py-2 text-sm text-[var(--text-primary)] focus:outline-none focus:border-cyan-500/50"},[t("option",Ue,a(e.$t("modals.schedulerDetail.everyMinutes")),1),t("option",We,a(e.$t("modals.schedulerDetail.daily")),1),t("option",Ee,a(e.$t("modals.schedulerDetail.weekly")),1),t("option",Le,a(e.$t("modals.schedulerDetail.monthly")),1),t("option",qe,a(e.$t("modals.schedulerDetail.customDays")),1)],512),[[$,i.value]])]),i.value==="everyMinutes"?(r(),l("div",ze,[t("label",Ae,a(e.$t("modals.schedulerDetail.interval")),1),h(t("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>T.value=s),class:"w-full bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-lg px-3 py-2 text-sm text-[var(--text-primary)] focus:outline-none focus:border-cyan-500/50"},[(r(),l(b,null,p([1,2,3,5,10,15,30],s=>t("option",{key:s,value:s},a(e.$t("modals.schedulerDetail.everyXMinutes",{minutes:s})),9,Be)),64))],512),[[$,T.value]])])):n("",!0),i.value==="weekly"?(r(),l("div",He,[t("label",Je,a(e.$t("modals.schedulerDetail.dayOfWeek")),1),h(t("select",{"onUpdate:modelValue":o[7]||(o[7]=s=>j.value=s),class:"w-full bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-lg px-3 py-2 text-sm text-[var(--text-primary)] focus:outline-none focus:border-cyan-500/50"},[t("option",Ke,a(e.$t("days.monday")),1),t("option",Xe,a(e.$t("days.tuesday")),1),t("option",Ye,a(e.$t("days.wednesday")),1),t("option",Ze,a(e.$t("days.thursday")),1),t("option",Ge,a(e.$t("days.friday")),1),t("option",Qe,a(e.$t("days.saturday")),1),t("option",et,a(e.$t("days.sunday")),1)],512),[[$,j.value]])])):n("",!0),i.value==="monthly"?(r(),l("div",tt,[t("label",st,a(e.$t("modals.schedulerDetail.dayOfMonth")),1),h(t("select",{"onUpdate:modelValue":o[8]||(o[8]=s=>O.value=s),class:"w-full bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-lg px-3 py-2 text-sm text-[var(--text-primary)] focus:outline-none focus:border-cyan-500/50"},[(r(),l(b,null,p(28,s=>t("option",{key:s,value:s},a(s),9,at)),64))],512),[[$,O.value]])])):n("",!0),i.value==="customDays"?(r(),l("div",ot,[t("label",lt,a(e.$t("modals.schedulerDetail.selectDays")),1),t("div",rt,[(r(),l(b,null,p(J,s=>t("label",{key:s.value,class:de(["flex items-center gap-1.5 px-3 py-1.5 rounded-lg cursor-pointer transition-colors",k.value.includes(s.value)?"bg-cyan-500 text-white border border-cyan-500":"bg-[var(--bg-surface)] text-[var(--text-secondary)] border border-[var(--border-subtle)] hover:bg-[var(--bg-overlay)]"])},[h(t("input",{type:"checkbox","onUpdate:modelValue":o[9]||(o[9]=u=>k.value=u),value:s.value,class:"sr-only"},null,8,dt),[[ne,k.value]]),t("span",nt,a(e.$t(`days.${s.key}`)),1)],2)),64))])])):n("",!0),i.value!=="everyMinutes"?(r(),l("div",it,[t("label",ut,a(e.$t("modals.schedulerDetail.time")),1),t("div",ct,[h(t("select",{"onUpdate:modelValue":o[10]||(o[10]=s=>V.value=s),class:"bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-lg px-3 py-2 text-sm text-[var(--text-primary)] focus:outline-none focus:border-cyan-500/50"},[(r(),l(b,null,p(24,s=>t("option",{key:s-1,value:String(s-1).padStart(2,"0")},a(String(s-1).padStart(2,"0")),9,vt)),64))],512),[[$,V.value]]),o[16]||(o[16]=t("span",{class:"text-[var(--text-secondary)]"},":",-1)),h(t("select",{"onUpdate:modelValue":o[11]||(o[11]=s=>F.value=s),class:"bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-lg px-3 py-2 text-sm text-[var(--text-primary)] focus:outline-none focus:border-cyan-500/50"},[(r(),l(b,null,p(60,s=>t("option",{key:s-1,value:String(s-1).padStart(2,"0")},a(String(s-1).padStart(2,"0")),9,mt)),64))],512),[[$,F.value]])])])):n("",!0),t("div",yt,[t("button",{onClick:o[12]||(o[12]=s=>f.value=!1),class:"px-4 py-2 text-sm text-[var(--text-primary)] hover:bg-[var(--bg-overlay)] rounded-lg transition-colors"},a(e.$t("common.cancel")),1),t("button",{onClick:Z,disabled:S.value,class:"px-4 py-2 bg-cyan-500 hover:bg-cyan-600 text-white rounded-lg text-sm transition-colors disabled:opacity-50"},a(S.value?e.$t("common.saving"):e.$t("common.save")),9,bt)])])):n("",!0)]),d.value.context?(r(),l("div",pt,[t("h3",ht,a(e.$t("modals.schedulerDetail.context")),1),t("div",xt,[d.value.context.steps&&d.value.context.steps.length?(r(),l("div",ft,[t("div",gt,a(e.$t("modals.schedulerDetail.steps")),1),t("ul",_t,[(r(!0),l(b,null,p(d.value.context.steps,(s,u)=>(r(),l("li",{key:u},a(s),1))),128))])])):n("",!0),d.value.context.variables&&Object.keys(d.value.context.variables).length?(r(),l("div",$t,[t("div",kt,a(e.$t("modals.schedulerDetail.variables")),1),t("div",wt,[(r(!0),l(b,null,p(d.value.context.variables,(s,u)=>(r(),l("div",{key:u},[t("span",Dt,a(u),1),ie(": "+a(s),1)]))),128))])])):n("",!0)])])):n("",!0),d.value.files&&d.value.files.length?(r(),l("div",Ct,[t("h3",St,a(e.$t("modals.schedulerDetail.files")),1),t("div",Mt,[t("div",It,a(d.value.files_dir),1),t("div",jt,[(r(!0),l(b,null,p(d.value.files,s=>(r(),l("span",{key:s,class:"px-2 py-1 bg-[var(--bg-surface)] rounded text-sm text-[var(--text-secondary)]"},a(s),1))),128))])])])):n("",!0),t("div",null,[t("h3",Ot,a(e.$t("modals.schedulerDetail.allRuns"))+" ("+a(d.value.conversations?.length||0)+")",1),d.value.conversations&&d.value.conversations.length?(r(),l("div",Vt,[(r(!0),l(b,null,p(d.value.conversations,s=>(r(),l("div",{key:s.id,class:"flex items-center gap-3 p-3 bg-[var(--bg-surface)] border border-[var(--border-subtle)] rounded-lg hover:bg-[var(--bg-overlay)] cursor-pointer transition-colors",onClick:u=>e.$emit("select-conversation",s.id)},[U(W(z),{class:"w-4 h-4 text-cyan-400 flex-shrink-0"}),t("div",Tt,[t("p",Pt,a(s.preview||e.$t("modals.schedulerDetail.noPreview")),1),t("p",Nt,a(N(s.created_at)),1)]),U(W(me),{class:"w-4 h-4 text-[var(--text-muted)]"})],8,Ft))),128))])):(r(),l("div",Rt,a(e.$t("modals.schedulerDetail.noRunsYet")),1))]),t("div",Ut,[t("span",null,a(e.$t("modals.schedulerDetail.totalRuns"))+": "+a(d.value.run_count||0),1),d.value.last_run_at?(r(),l("span",Wt,a(e.$t("modals.schedulerDetail.lastRun"))+": "+a(N(d.value.last_run_at)),1)):n("",!0),t("span",null,a(e.$t("modals.schedulerDetail.created"))+": "+a(N(d.value.created_at)),1)])])):n("",!0),d.value?(r(),l("div",Et,[t("button",{onClick:ee,class:"px-4 py-2 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-colors"},a(e.$t("modals.schedulerDetail.deleteScheduler")),1),t("div",Lt,[t("button",{onClick:Q,disabled:M.value,class:"px-4 py-2 text-sm bg-emerald-500 hover:bg-emerald-600 text-white rounded-lg transition-colors disabled:opacity-50"},a(M.value?e.$t("common.loading"):e.$t("modals.schedulerDetail.runNow")),9,qt),t("button",{onClick:o[13]||(o[13]=s=>e.$emit("close")),class:"px-4 py-2 text-sm bg-white/10 hover:bg-white/20 text-[var(--text-primary)] rounded-lg transition-colors"},a(e.$t("common.close")),1)])])):n("",!0)])]))}};export{Kt as default};
