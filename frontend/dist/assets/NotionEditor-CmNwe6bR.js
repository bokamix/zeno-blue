import{u as B,S as L,P as A,M as $,E as H}from"./tiptap-N4ivBHz1.js";import{r as u,o as y,a as C,e as d,i as v,l,F as E,p as M,B as a,u as o,A as N,L as P}from"./vue-core-jACk-pto.js";const F={class:"notion-editor flex flex-col h-full"},I={key:0,class:"flex items-center justify-center h-64"},T={class:"toolbar sticky top-0 z-10 flex items-center gap-1 p-2 bg-[var(--bg-surface)] border-b border-[var(--border-subtle)] rounded-t-lg flex-wrap"},j={key:0,class:"text-xs text-amber-400 mr-3"},q={key:1,class:"text-xs text-green-400 mr-3"},z=["disabled"],K={class:"editor-wrapper flex-1 overflow-auto bg-[var(--bg-base)] rounded-b-lg"},V={__name:"NotionEditor",props:{url:{type:String,required:!0},filePath:{type:String,required:!0},isMarkdown:{type:Boolean,default:!0}},emits:["close","saved"],setup(w,{emit:S}){const b=w,c=S,f=u(!0),i=u(!1),g=u(!1),r=u(!1),p=u(""),t=B({extensions:[L.configure({heading:{levels:[1,2,3]}}),A.configure({placeholder:"Start typing..."}),$.configure({html:!0,tightLists:!0,bulletListMarker:"-",linkify:!0,breaks:!0})],editorProps:{attributes:{class:"prose max-w-none focus:outline-none"}},onUpdate:()=>{r.value=!0,g.value=!1}});y(async()=>{try{const e=await(await fetch(b.url)).text();if(p.value=e,t.value){if(b.isMarkdown)t.value.commands.setContent(e);else{const s=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");t.value.commands.setContent(`<p>${s}</p>`)}r.value=!1}}catch(n){console.error("Failed to load file:",n),t.value&&t.value.commands.setContent("<p><em>Failed to load file</em></p>")}finally{f.value=!1}}),C(()=>{t.value?.destroy()});function h(){return t.value?b.isMarkdown?t.value.storage.markdown.getMarkdown():t.value.getText():""}async function m(){if(!(!r.value||i.value)){i.value=!0;try{const n=h(),e=await fetch("/artifacts/content",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:b.filePath,content:n})});if(!e.ok){const s=await e.json();throw new Error(s.detail||"Save failed")}r.value=!1,g.value=!0,p.value=n,c("saved"),setTimeout(()=>{g.value=!1},2e3)}catch(n){console.error("Save failed:",n),alert("Failed to save: "+n.message)}finally{i.value=!1}}}function x(){r.value&&!confirm("You have unsaved changes. Are you sure you want to close?")||c("close")}function k(n){(n.ctrlKey||n.metaKey)&&n.key==="s"&&(n.preventDefault(),m()),n.key==="Escape"&&(n.preventDefault(),x())}return y(()=>{document.addEventListener("keydown",k)}),C(()=>{document.removeEventListener("keydown",k)}),(n,e)=>(v(),d("div",F,[f.value?(v(),d("div",I,[...e[12]||(e[12]=[l("span",{class:"text-[var(--text-muted)]"},"Loading...",-1)])])):(v(),d(E,{key:1},[l("div",T,[l("button",{onClick:e[0]||(e[0]=s=>o(t)?.chain().focus().toggleBold().run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("bold")},"toolbar-btn"]),title:"Bold (Ctrl+B)"},[...e[13]||(e[13]=[l("strong",null,"B",-1)])],2),l("button",{onClick:e[1]||(e[1]=s=>o(t)?.chain().focus().toggleItalic().run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("italic")},"toolbar-btn"]),title:"Italic (Ctrl+I)"},[...e[14]||(e[14]=[l("em",null,"I",-1)])],2),l("button",{onClick:e[2]||(e[2]=s=>o(t)?.chain().focus().toggleStrike().run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("strike")},"toolbar-btn"]),title:"Strikethrough"},[...e[15]||(e[15]=[l("s",null,"S",-1)])],2),e[16]||(e[16]=l("div",{class:"w-px h-5 bg-[var(--border-subtle)] mx-1"},null,-1)),l("button",{onClick:e[3]||(e[3]=s=>o(t)?.chain().focus().toggleHeading({level:1}).run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("heading",{level:1})},"toolbar-btn"]),title:"Heading 1"}," H1 ",2),l("button",{onClick:e[4]||(e[4]=s=>o(t)?.chain().focus().toggleHeading({level:2}).run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("heading",{level:2})},"toolbar-btn"]),title:"Heading 2"}," H2 ",2),l("button",{onClick:e[5]||(e[5]=s=>o(t)?.chain().focus().toggleHeading({level:3}).run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("heading",{level:3})},"toolbar-btn"]),title:"Heading 3"}," H3 ",2),e[17]||(e[17]=l("div",{class:"w-px h-5 bg-[var(--border-subtle)] mx-1"},null,-1)),l("button",{onClick:e[6]||(e[6]=s=>o(t)?.chain().focus().toggleBulletList().run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("bulletList")},"toolbar-btn"]),title:"Bullet List"}," • List ",2),l("button",{onClick:e[7]||(e[7]=s=>o(t)?.chain().focus().toggleOrderedList().run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("orderedList")},"toolbar-btn"]),title:"Numbered List"}," 1. List ",2),l("button",{onClick:e[8]||(e[8]=s=>o(t)?.chain().focus().toggleBlockquote().run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("blockquote")},"toolbar-btn"]),title:"Quote"}," “ Quote ",2),e[18]||(e[18]=l("div",{class:"w-px h-5 bg-[var(--border-subtle)] mx-1"},null,-1)),l("button",{onClick:e[9]||(e[9]=s=>o(t)?.chain().focus().toggleCode().run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("code")},"toolbar-btn"]),title:"Inline Code"}," </> ",2),l("button",{onClick:e[10]||(e[10]=s=>o(t)?.chain().focus().toggleCodeBlock().run()),class:a([{"bg-[var(--bg-elevated)]":o(t)?.isActive("codeBlock")},"toolbar-btn"]),title:"Code Block"}," Code ",2),e[19]||(e[19]=l("div",{class:"w-px h-5 bg-[var(--border-subtle)] mx-1"},null,-1)),l("button",{onClick:e[11]||(e[11]=s=>o(t)?.chain().focus().setHorizontalRule().run()),class:"toolbar-btn",title:"Horizontal Rule"}," — "),e[20]||(e[20]=l("div",{class:"flex-1"},null,-1)),r.value?(v(),d("span",j," Unsaved changes ")):g.value?(v(),d("span",q," Saved ")):M("",!0),l("button",{onClick:m,disabled:i.value||!r.value,class:"px-3 py-1 text-sm text-white bg-blue-600 hover:bg-blue-500 disabled:bg-[var(--bg-elevated)] disabled:text-[var(--text-muted)] disabled:cursor-not-allowed rounded transition-colors",title:"Save (Ctrl+S)"},N(i.value?"Saving...":"Save"),9,z)]),l("div",K,[P(o(H),{editor:o(t),class:"editor-content p-6 min-h-[400px]"},null,8,["editor"])]),l("div",{class:"actions flex items-center justify-end mt-4"},[l("button",{onClick:x,class:"px-4 py-2 text-sm text-[var(--text-secondary)] hover:text-[var(--text-primary)] bg-[var(--bg-surface)] hover:bg-[var(--bg-elevated)] rounded-lg transition-colors"}," Close ")])],64))]))}};export{V as default};
